"""""""""""""""""""" original contents""""""""""""""""""""""""

set nocompatible

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" inoremap <C-s> <C-o>dw

""""""""""""""""" Section å…¨å±€è®¾ç½®"""""""""""""

" æ–‡ä»¶ç¼–ç 
set enc=utf-8
" ä¸è‡ªåŠ¨å¤‡ä»½ï¼Œç”Ÿæˆè®¨åŒçš„~
set nobackup

" swpæ–‡ä»¶å•ç‹¬å­˜æ”¾, NOTE!!! è¿™ä¸ªç›®å½•è¦æ‰‹åŠ¨å»ºç«‹
set directory=${HOME}/.vimswapfiles//

let mapleader=";"

" vim è‡ªèº«å‘½ä»¤è¡Œæ¨¡å¼æ™ºèƒ½è¡¥å…¨
set wildmenu

" å¤šå­—èŠ‚å­—ç¬¦æ˜¾ç¤º
set ambiwidth=double

""""""""""""""""""""""""""""""""""""""""""



""""""""""""""""" Section æ’ä»¶ç®¡ç†"""""""""""""""""

" å°† pathogen è‡ªèº«ä¹Ÿç½®äºç‹¬ç«‹ç›®å½•ä¸­ï¼Œéœ€æŒ‡å®šå…¶è·¯å¾„
runtime autoload/pathogen.vim
" è¿è¡Œ pathogen
execute pathogen#infect()

""""""""""""""""""""""""""""""""""""""""""



""""""""""""""" Helper Functions""""""""""""""""""
" æ ¡å‡†å…‰æ ‡ï¼Œä»tagbarç§»åŠ¨åˆ°ä¸»çª—å£
function! AdjustCursor()
    if (&ft=='tagbar')
        call feedkeys("\<C-w>\<Right>")
    endif
endfunction
"""""""""""""""""""""""""""""""""""""""""""""""""""



""""""""""""""""" Section æ˜¾ç¤º""""""""""""""""""""
" Maximize gvim window.
if has("gui_running")
    " GUI is running or is about to start.
    set lines=999 columns=999
endif

" è®¾ç½®å­—ä½“
" set guifont=YaHei_Consolas_Hybrid:h16:cANSI
set guifont=Consolas:h24

""" é…è‰²æ–¹æ¡ˆ
set background=dark
colorscheme molokai

"" ç¦æ­¢æ˜¾ç¤ºæ»šåŠ¨æ¡ scroll bar
set guioptions-=l
set guioptions-=L
set guioptions-=r
set guioptions-=R
"" ç¦æ­¢æ˜¾ç¤ºèœå•å’Œå·¥å…·æ¡
" set guioptions-=m
set guioptions-=T

set laststatus=2 	" æ€»æ˜¯æ˜¾ç¤ºçŠ¶æ€æ 
set ruler			" æ˜¾ç¤ºå…‰æ ‡å½“å‰ä½ç½®
set nu	 			" å¼€å¯è¡Œå·æ˜¾ç¤º
set cursorline 		" é«˜äº®æ˜¾ç¤ºå½“å‰è¡Œ
set cursorcolumn	" é«˜äº®æ˜¾ç¤ºå½“å‰åˆ—
set nowrap 			" ç¦æ­¢æŠ˜è¡Œ

" è®¾ç½®çŠ¶æ€æ ä¸»é¢˜é£æ ¼
let g:Powerline_colorscheme='solarized256'

"" è¯­æ³•é«˜äº®
syntax enable 		" å¼€å¯è¯­æ³•é«˜äº®åŠŸèƒ½
syntax on 			" å…è®¸ç”¨æŒ‡å®šè¯­æ³•é«˜äº®é…è‰²æ–¹æ¡ˆæ›¿æ¢é»˜è®¤æ–¹æ¡ˆ

""" ç¼©è¿›
filetype indent on 	" è‡ªé€‚åº”ä¸åŒè¯­è¨€çš„æ™ºèƒ½ç¼©è¿›
set expandtab 		" å°†åˆ¶è¡¨ç¬¦æ‰©å±•ä¸ºç©ºæ ¼
set tabstop=4 		" è®¾ç½®ç¼–è¾‘æ—¶åˆ¶è¡¨ç¬¦å ç”¨ç©ºæ ¼æ•°
set shiftwidth=4 	" è®¾ç½®æ ¼å¼åŒ–æ—¶åˆ¶è¡¨ç¬¦å ç”¨ç©ºæ ¼æ•°
set softtabstop=4 	" è®© vim æŠŠè¿ç»­æ•°é‡çš„ç©ºæ ¼è§†ä¸ºä¸€ä¸ªåˆ¶è¡¨ç¬¦
"" ç¼©è¿›å¯è§†åŒ–æ’ä»¶ Indent Guides
let g:indent_guides_enable_on_vim_startup=1 		" éš vim è‡ªå¯åŠ¨
let g:indent_guides_start_level=2					" ä»ç¬¬äºŒå±‚å¼€å§‹å¯è§†åŒ–æ˜¾ç¤ºç¼©è¿›
let g:indent_guides_guide_size=1					" è‰²å—å®½åº¦
" å¿«æ·é”® im å¼€/å…³ç¼©è¿›å¯è§†åŒ–
nmap <silent> <Leader>im <Plug>IndentGuidesToggle

""" ä»£ç æŠ˜å 
set foldmethod=syntax 		" åŸºäºç¼©è¿›æˆ–è¯­æ³•è¿›è¡Œä»£ç æŠ˜å 
set nofoldenable 			" å¯åŠ¨ vim æ—¶å…³é—­æŠ˜å ä»£ç 

""" ç¦æ­¢ plugin: YouCompleteMe è¯­æ³•é”™è¯¯é«˜äº®æ˜¾ç¤º
let g:ycm_enable_diagnostic_signs = 0
let g:ycm_enable_diagnostic_highlighting = 0

""" Enable multiple highlights at startup ç”¨ä¸åŒé¢œè‰²é«˜äº®ä¸åŒå•è¯ highlights.vim
" æ¨¡æ‹Ÿé”®ç›˜æŒ‰é”®ï¼Œè¿™é‡Œä¸çŸ¥å¦‚ä½•å¼•ç”¨<leader>
autocmd VimEnter * nested :call feedkeys(";hi")

""""""""""""""""""""""""""""""""""""""""""""



""""""""""""""""""" Section æ§åˆ¶ Control""""""""""""""""""

" set mouse=a 			" å¼€å¯é¼ æ ‡åŠŸèƒ½, å¯ä»¥æ‹–åŠ¨çª—å£å¤§å°
filetype on 			" å¼€å¯æ–‡ä»¶ç±»å‹ä¾¦æµ‹
filetype plugin on 		" æ ¹æ®ä¾¦æµ‹åˆ°çš„ä¸åŒç±»å‹åŠ è½½å¯¹åº”çš„æ’ä»¶

" å®šä¹‰å¿«æ·é”®å…³é—­å½“å‰åˆ†å‰²çª—å£
nmap <silent> <Leader>qt :q<CR>
" å®šä¹‰å¿«æ·é”®ä¿å­˜å½“å‰çª—å£å†…å®¹
nmap <Leader>w :w<CR>
" å®šä¹‰å¿«æ·é”®ä¿å­˜æ‰€æœ‰çª—å£å†…å®¹å¹¶é€€å‡º vim
nmap <Leader>WQ :wa<CR>:q<CR>
" ä¸åšä»»ä½•ä¿å­˜ï¼Œç›´æ¥é€€å‡º vim
" nmap <Leader>Q :qa!<CR>

" Highlight without moving cursor
nnoremap <silent>* :let @/='\<<C-R>=expand("<cword>")<CR>\>'<CR>:set hls<CR>
vnoremap <silent>* y:let @/='<C-r>0'<CR>:set hls<CR>
" vmap * y/\<\><Left><Left><C-r>0<CR>

" å¤åˆ¶é€‰åŒºåå…‰æ ‡ä¸åŠ¨
vmap y ygv<ESC>
" è®¾ç½®å¿«æ·é”®å°†é€‰ä¸­æ–‡æœ¬å—å¤åˆ¶è‡³ç³»ç»Ÿå‰ªè´´æ¿
" vnoremap <Leader>y "+y
vmap <Leader>y "*ygv<ESC>
" è®¾ç½®å¿«æ·é”®å°†é€‰ä¸­æ–‡æœ¬å—å‰ªåˆ‡è‡³ç³»ç»Ÿå‰ªè´´æ¿
" vnoremap <Leader>x "+d
vmap <Leader>d "*d
" ç²˜è´´åå…‰æ ‡åœ¨æœ«å°¾
nmap p pgp<ESC>
vmap p pgp<ESC>
nmap P Pgp<ESC>
vmap P Pgp<ESC>
" è®¾ç½®å¿«æ·é”®å°†ç³»ç»Ÿå‰ªè´´æ¿å†…å®¹ç²˜è´´è‡³vim åœ¨å…‰æ ‡ä¹‹å
" nmap <Leader>p "+p
nmap <Leader>p "*pgp<ESC>
vmap <Leader>p "*pgp<ESC>
" è®¾ç½®å¿«æ·é”®å°†ç³»ç»Ÿå‰ªè´´æ¿å†…å®¹ç²˜è´´è‡³vim åœ¨å…‰æ ‡ä¹‹å‰
" nmap <Leader>P "+P
nmap <Leader>P "*Pgp<ESC>
vmap <Leader>P "*Pgp<ESC>
" é€‰ä¸­åˆšåˆšæ›´æ”¹çš„å¦‚ç²˜è´´, select just changed as paste
nnoremap <expr> gp '`[' . strpart(getregtype(), 0, 1) . '`]'
" Copy / cut to sys clipboard
nmap <Leader>yiw "*yiw
nmap <Leader>yiW "*yiW
nmap <Leader>diw "*diw
nmap <Leader>diW "*diW
nmap <Leader>yy "*yy
nmap <Leader>dd "*dd

" åˆ é™¤è¡Œå°¾ç©ºæ ¼
nnoremap <Leader>rtw :%s/\s\+$//<CR>
" åˆ é™¤ç©ºè¡Œ
nnoremap <Leader>rel :g/^\s*$/d<CR>
" æ–­è¡Œ, split line
nnoremap K i<CR><Esc>

" å°†å¤–éƒ¨å‘½ä»¤ wmctrl æ§åˆ¶çª—å£æœ€å¤§åŒ–çš„å‘½ä»¤è¡Œå‚æ•°å°è£…æˆä¸€ä¸ª vim çš„å‡½æ•°
fun! ToggleFullscreen()
	call system("wmctrl -ir " . v:windowid . " -b toggle,fullscreen")
endf

nmap <C-F11> :set wrap! linebreak nolist<CR>
" å…¨å±å¼€/å…³å¿«æ·é”®
nnoremap <F11> :call ToggleFullscreen()<CR>
"autocmd VimEnter * call ToggleFullscreen() 		" å¯åŠ¨ vim æ—¶è‡ªåŠ¨å…¨å±

" inoremap <c-s> <c-o>:w<CR>			" ctrl-s Save ä¿å­˜åè¿”å›åŸ(æ’å…¥)æ¨¡å¼ only work in gvim


""" å¤šæ–‡æ¡£ç¼–è¾‘ MiniBufExplorer
" disable auto open
let g:miniBufExplorerAutoStart = 0
let g:miniBufExplMaxSize = 1

" æ˜¾ç¤º/éšè— MiniBufExplorer çª—å£
nnoremap <silent><Leader>bl :MBEToggle<CR>
nnoremap <silent><S-F9> :MBEToggle<CR>
nnoremap <F12> :TagbarToggle<CR>
" close tab
nmap <leader>ct :MBEbd<CR>
"" buffer åˆ‡æ¢å¿«æ·é”®
nnoremap <C-Tab> :MBEbn<cr>
nnoremap <C-S-Tab> :MBEbp<cr>

""" plugin: NERDTree æ–‡ä»¶æµè§ˆå™¨
" autocmd VimEnter * nested :NERDTree				" å¯åŠ¨vimè‡ªåŠ¨å¼€å¯

""" Move cursor to Main window
" autocmd VimEnter * nested :wincmd h 				" left to main window
" autocmd VimEnter * nested :wincmd j 				" down to main


""" å·¥ç¨‹æ–‡ä»¶æµè§ˆ plugin: NERDTree
" ä½¿ç”¨ NERDTree æ’ä»¶æŸ¥çœ‹å·¥ç¨‹æ–‡ä»¶ã€‚è®¾ç½®å¿«æ·é”®ï¼Œé€Ÿè®°ï¼šfile list
nmap <Leader>fl :NERDTreeToggle<CR>
nmap <Leader>lf :NERDTreeFind<CR>
nmap <C-F10> :NERDTreeFind<CR>
nmap <F10> :NERDTreeToggle<CR>
let NERDTreeWinSize=40					" è®¾ç½® NERDTree å­çª—å£å®½åº¦
let NERDTreeWinPos="right"				" è®¾ç½® NERDTree å­çª—å£ä½ç½®
" let NERDTreeShowHidden=1				" æ˜¾ç¤ºéšè—æ–‡ä»¶
let NERDTreeMinimalUI=1					" NERDTree å­çª—å£ä¸­ä¸æ˜¾ç¤ºå†—ä½™å¸®åŠ©ä¿¡æ¯
let NERDTreeAutoDeleteBuffer=1			" åˆ é™¤æ–‡ä»¶æ—¶è‡ªåŠ¨åˆ é™¤æ–‡ä»¶å¯¹åº” buffer
autocmd FileType nerdtree nmap <silent><buffer> <Esc> :q<CR>
autocmd FileType nerdtree nmap <silent><buffer> <Space> <CR>:NERDTreeToggle<CR>
" filter
let NERDTreeIgnore=['\.vim$', '^tags$', '^cscope\.']

" F4 å…³é—­å½“å‰æ ‡ç­¾
nnoremap <F4> :bd<CR>
""" BufOnly.vim
" close all buffers except this
noremap <S-F4> :BufOnly<CR>

""" åˆ†å‰²çª—å£ split window
nmap <leader>sp :sp<CR><C-w><Down>
nmap <leader>vs :vs<CR><C-w><Right>

" scroll horizontally
nmap <S-C-Left> 5zh
nmap <S-C-Right> 5zl
nmap <S-Left> zH
nmap <S-Right> zL

function! ScrollDown()
    let distance = winheight(0) / 3
    let feedKeyStr = distance . "\<C-E>"
    call feedkeys(feedKeyStr)
endfunction

function! ScrollUp()
    let distance = winheight(0) / 3
    let feedKeyStr = distance . "\<C-Y>"
    call feedkeys(feedKeyStr)
endfunction

nmap <C-U> :call ScrollUp()<CR>
nmap <C-D> :call ScrollDown()<CR>

nmap <leader>qf :call ToggleQuickfixList()<CR>

autocmd FileType qf nmap <buffer> 1 :colder<CR>
autocmd FileType qf nmap <buffer> 2 :cnewer<CR>
autocmd FileType qf nmap <buffer> ! :lolder<CR>
autocmd FileType qf nmap <buffer> @ :lnewer<CR>
nmap <C-k>  :cprev<CR>zz
nmap <C-j>  :cnext<CR>zz
nmap <C-a>  :lprev<CR>zz
nmap <C-z>  :lnext<CR>zz

" For QuickFix and Locationlist window
" Space jump to item and close
autocmd FileType qf nmap <silent><buffer> <space> <CR>:q<CR>:call AdjustCursor()<CR>
" Enter jump but not move out the window
autocmd FileType qf nnoremap <silent><buffer> <CR> <CR><C-W><C-P>
" Esc for close
autocmd FileType qf nmap <silent><buffer> <Esc> :q<CR>:call AdjustCursor()<CR>
autocmd FileType help nmap <silent><buffer> <Esc> :q<CR>:call AdjustCursor()<CR>
autocmd FileType gundo nmap <silent><buffer> <Esc> :q<CR>:call AdjustCursor()<CR>
nnoremap <silent><Esc> <Esc>:lcl<CR>:ccl<CR>:silent UniteClose<CR>

""" Session
" goto home
autocmd VimEnter * nested :let PrjHome = getcwd()
nnoremap <C-h> :cd `=PrjHome`<CR>:pwd<CR>

" save session (buffer list)
command Ss :set sessionoptions=buffers | :mksession! session.vim | :echo "session saved"
command Ls :source session.vim

function! AutoSaveSession()
   if filereadable("session.vim")
       execute 'Ss'
   endif
endfunction
autocmd VimLeave * :call AutoSaveSession()

function! AutoLoadSession()
   if filereadable("session.vim")
       execute 'Ls'
   endif
endfunction
autocmd VimEnter * nested :call AutoLoadSession()

nmap <C-ScrollWheelDown> 9zl
nmap <C-ScrollWheelUp> 9zh

"""""""""""""""""""""""""""""""""""""""""""""""""



""""""""""""""""""" Section æŸ¥æ‰¾æ›¿æ¢ Find & Replace""""""""""""""""""

" å–æ¶ˆæœç´¢ç»“æœé«˜äº®æ˜¾ç¤ºå¹¶åˆ·æ–°å±å¹•
nnoremap <silent> <C-l> :nohl<CR><C-l>
" nnoremap <silent> <C-h> :nohl<CR>
set incsearch 	" å¼€å¯å®æ—¶æœç´¢åŠŸèƒ½
set ignorecase 	" æœç´¢æ—¶å¤§å°å†™ä¸æ•æ„Ÿ
set hlsearch 	" é«˜äº®æ˜¾ç¤ºæœç´¢ç»“æœ

""" é€‰å–å†…æŸ¥æ‰¾
function! RangeSearch(direction)
  call inputsave()
  let g:srchstr = input(a:direction)
  call inputrestore()
  if strlen(g:srchstr) > 0
    let g:srchstr = g:srchstr.
          \ '\%>'.(line("'<")-1).'l'.
          \ '\%<'.(line("'>")+1).'l'
  else
    let g:srchstr = ''
  endif
endfunction
vnoremap <silent> / :<C-U>call RangeSearch('/')<CR>:if strlen(g:srchstr) > 0\|exec '/'.g:srchstr\|endif<CR>
vnoremap <silent> ? :<C-U>call RangeSearch('?')<CR>:if strlen(g:srchstr) > 0\|exec '?'.g:srchstr\|endif<CR>

""" plugin: ack
"" shift: search all in root dir recursively
"" ctrl: search in the file dir recursively
noremap <leader>sa :Ack! -rkw <cword><CR>
nmap <S-F3> yiw:Ack! -rkw ""<Left><C-r>0<CR>/\<\><Left><Left><C-r>0<CR>
vmap <S-F3> y:Ack! -rkw ""<Left><C-r>0<CR>/\<\><Left><Left><C-r>0<CR>
nmap <F3> yiw:Grep -w  %<Left><Left><C-r>0<CR>/\<\><Left><Left><C-r>0<CR>
vmap <F3> y:Grep  %<Left><Left><C-r>0<CR>/<C-r>0<CR>
nnoremap <leader>ack :Ack! -rkwi ""<Left>
nmap <leader>sd *:Ack! -rkw <cword> %:p:h<CR>
vmap <leader>sd *y:Ack! -rkw "" %:p:h<Left><Left><Left><Left><Left><Left><Left><C-r>0<CR>
nnoremap <Leader>isd :Ack! -rkwi "" %:p:h<Left><Left><Left><Left><Left><Left><Left>
nmap <F8> <Leader>sd
vmap <F8> <Leader>sd
nmap <S-F8> <Leader>isd
nmap <F2> :Grep -wi  %<Left><Left>
nmap <S-F2> <Leader>ack
nmap <leader>gr :Rgrep -wi  *<Left><Left>
nmap <leader>ga :RgrepAdd -wi  *<Left><Left>
nmap <leader>lgr :Rgrep -wi  *.h *.hpp *.cpp *.cc *.c *.cxx *.java *.py<Home><Right><Right><Right><Right><Right><Right><Right><Right><Right><Right>
nmap <leader>/ /\<\><Left><Left>
" æœç´¢å½“å‰é€‰ä¸­æ–‡æœ¬ search selected
vmap <Leader>/ y/\<\><Left><Left><C-r>0<CR>

""" æ›¿æ¢
vnoremap <F5> :s/<C-r>///g<Left><Left>
nnoremap <F5> :s/<C-r>///g<Left><Left>
vnoremap <S-F5> :%s/<C-r>///g<Left><Left>
nnoremap <S-F5> :%s/<C-r>///g<Left><Left>

"""""""""""""""""""""""""""""""""""""""""""""""""



"""""""""""""""""""""""""" Section ä»£ç å¯¼èˆª Code Nav""""""""""""""""""""""""""""
""""""" ctags
set csto=1      " Search tag file before cscope
" See http://vim.wikia.com/wiki/Single_tags_file_for_a_source_tree
set tags=tags;

" è‡ªåŠ¨åŠ è½½tagsè·¯å¾„è®¾ç½®
function! SetTags()
   if filereadable("tags.vim")
       execute 'source! tags.vim'
   endif
endfunction
autocmd VimEnter * nested :silent! call SetTags()<CR>

" nmap <Leader>ts yiw:ts <c-r>0<CR>
" vmap <Leader>ts y:ts /<c-r>0<CR>
nmap <Leader>lt yiw:ltag <c-r>0<CR>:lopen<CR>/\<<C-r>0\><CR>
vmap <Leader>lt y:ltag /<c-r>0<CR>:lopen<CR>/\<<C-r>0\><CR>
nmap <space> <Leader>lt
vmap <space> <Leader>lt
nmap <silent><F1> :call ToggleQuickfixList()<CR>:call AdjustCursor()<CR>
nmap <silent><S-F1> :call ToggleLocationList()<CR>:call AdjustCursor()<CR>
" location list å’Œ quickfix æŒ‰ç©ºæ ¼è·³è½¬åˆ°æ¡ç›®åè‡ªåŠ¨å…³é—­
" autocmd FileType qf nmap <buffer> <cr> <cr>:lcl<cr>
"""""""""""""

""""""" cscope
" è‡ªåŠ¨å¯»æ‰¾å¹¶æ·»åŠ å½“å‰ç›®å½•ä¸‹çš„æ•°æ®åº“
autocmd VimEnter * nested :cs add .
" å°†ç»“æœæ˜¾ç¤ºäºquickfix window
set cscopequickfix=s-,c-,d-,i-,t-,e-,g-
" find symbol
nnoremap  <leader>fs yiw:cs find s <C-r>0<CR>:copen<CR>/\<\><Left><Left><C-r>0<CR>
" find definition
nnoremap  <leader>fg yiw:cs find g <C-r>0<CR>:copen<CR>/\<\><Left><Left><C-r>0<CR>
" called by this
nnoremap  <leader>fd yiw:cs find d <C-r>0<CR>:copen<CR>/\<\><Left><Left><C-r>0<CR>
" call this
nnoremap  <leader>fc yiw:cs find c <C-r>0<CR>:copen<CR>/\<\><Left><Left><C-r>0<CR>
" text
nnoremap  <leader>ft yiw:cs find t <C-r>0<CR>:copen<CR>/\<\><Left><Left><C-r>0<CR>
vnoremap  <leader>ft y:cs find t <C-r>0<CR>:copen<CR>/\<\><Left><Left><C-r>0<CR>
" grep
nnoremap  <leader>fe yiw:cs find e <C-r>0<CR>:copen<CR>/<C-r>0<CR>
vnoremap  <leader>fe y:cs find e <C-r>0<CR>:copen<CR>/<C-r>0<CR>
" this file
nnoremap  <leader>ff yiw:cs find f <C-r>0<CR>:copen<CR>/\<\><Left><Left><C-r>0<CR>
" including this file
nnoremap  <leader>fi yiw:cs find i <C-r>0<CR>:copen<CR>/\<\><Left><Left><C-r>0<CR>

nmap <S-space> <leader>fc
"""""""""""""""

""" æ¥å£ä¸å®ç°å¿«é€Ÿåˆ‡æ¢ plugin: a.vim
" *.cpp å’Œ *.h é—´åˆ‡æ¢
nmap <Leader>ch :A<CR>
" å­çª—å£ä¸­æ˜¾ç¤º *.cpp æˆ– *.h
nmap <Leader>sch :AS<CR>

""" è¿™ä¸¤ä¸ªåŠŸèƒ½æ˜¯vim tagåŠŸèƒ½ä¸€éƒ¨åˆ†
" æ­£å‘éå†åŒåæ ‡ç­¾
nmap <Leader>tn :tnext<CR>
" åå‘éå†åŒåæ ‡ç­¾
nmap <Leader>tp :tprevious<CR>

""" åŸºäºè¯­ä¹‰çš„ä»£ç å¯¼èˆª plugin: YouCompleteMe
nnoremap <leader>jd :YcmCompleter GoToDeclaration<CR>
" åªèƒ½æ˜¯ #include æˆ–å·²æ‰“å¼€çš„æ–‡ä»¶
nnoremap <leader>je :YcmCompleter GoToDefinition<CR>

""" æ ‡ç­¾åˆ—è¡¨ plugin: tagbar
" é»˜è®¤æŒ‰æºæ–‡ä»¶ä¸­å®šä¹‰é¡ºåºè€Œä¸æ˜¯å­—æ¯
let g:tagbar_sort = 0
" è®¾ç½® tagbar å­çª—å£çš„ä½ç½®å‡ºç°åœ¨ä¸»ç¼–è¾‘åŒºçš„å·¦è¾¹
let tagbar_left=1
" è®¾ç½®æ˜¾ç¤ºï¼éšè—æ ‡ç­¾åˆ—è¡¨å­çª—å£çš„å¿«æ·é”®ã€‚é€Ÿè®°ï¼štag list
nnoremap <Leader>tl :TagbarToggle<CR>
" è®¾ç½®æ ‡ç­¾å­çª—å£çš„å®½åº¦
let tagbar_width=25
" tagbar å­çª—å£ä¸­ä¸æ˜¾ç¤ºå†—ä½™å¸®åŠ©ä¿¡æ¯
let g:tagbar_compact=1
" è®¾ç½® ctags å¯¹å“ªäº›ä»£ç å…ƒç´ ç”Ÿæˆæ ‡ç­¾
let g:tagbar_type_cpp = {
     \ 'ctagstype' : 'c++',
     \ 'kinds'     : [
         \ 'd:macros:1',
         \ 'g:enums',
         \ 't:typedefs:0:0',
         \ 'e:enumerators:0:0',
         \ 'n:namespaces',
         \ 'c:classes',
         \ 's:structs',
         \ 'u:unions',
         \ 'f:functions',
         \ 'm:members:0:0',
         \ 'v:global:0:0',
         \ 'x:external:0:0',
         \ 'l:local:0:0'
     \ ],
     \ 'sro'        : '::',
     \ 'kind2scope' : {
         \ 'g' : 'enum',
         \ 'n' : 'namespace',
         \ 'c' : 'class',
         \ 's' : 'struct',
         \ 'u' : 'union'
     \ },
     \ 'scope2kind' : {
         \ 'enum'      : 'g',
         \ 'namespace' : 'n',
         \ 'class'     : 'c',
         \ 'struct'    : 's',
         \ 'union'     : 'u'
     \ }
\ }

" autocmd VimEnter * nested :TagbarOpen				" å¯åŠ¨vimè‡ªåŠ¨å¼€å¯
" å¯åŠ¨vimè‡ªåŠ¨å¼€å¯ä»…å¯¹æ‰€æ”¯æŒæ–‡ä»¶ç±»å‹
autocmd VimEnter * nested :call tagbar#autoopen(1)
" nmap <Tab> <Return>                            " é˜²æ­¢é¼ æ ‡åŒå‡»å¯¼è‡´ç¨‹åºå´©æºƒCtrl-I ä¸èƒ½å·¥ä½œ

""" cscope
" set cst					" ç”¨cscopeå®ç°ctagsåŠŸèƒ½ cscopetag
" autocmd VimEnter * nested :silent cs add cscope.out
" nnoremap <leader>fa :call cscope#findInteractive(expand('<cword>'))<CR>
nnoremap <leader>ll :call ToggleLocationList()<CR>
" s: Find this C symbol
" nnoremap  <leader>fs yiw:call cscope#find('s', expand('<cword>'))<CR>/\<\><Left><Left><C-r>0<CR>
" g: Find this definition
" nnoremap  <leader>fg yiw:call cscope#find('g', expand('<cword>'))<CR>/\<\><Left><Left><C-r>0<CR>
" d: Find functions called by this function
" nnoremap  <leader>fd yiw:call cscope#find('d', expand('<cword>'))<CR>/\<\><Left><Left><C-r>0<CR>
" c: Find functions calling this function
" nnoremap  <leader>fc yiw:call cscope#find('c', expand('<cword>'))<CR>/\<\><Left><Left><C-r>0<CR>
" t: Find this text string
" nnoremap  <leader>ft yiw:call cscope#find('t', expand('<cword>'))<CR>/\<\><Left><Left><C-r>0<CR>
" vnoremap  <leader>ft y:call cscope#find('t', expand(''))<Left><Left><Left><C-r>0<CR>/\<\><Left><Left><C-r>0<CR>
" e: Find this egrep pattern
" nnoremap  <leader>fe yiw:call cscope#find('e', expand('<cword>'))<CR>/\<\><Left><Left><C-r>0<CR>
" vnoremap  <leader>fe y:call cscope#find('e', expand('<cword>'))<CR>/\<\><Left><Left><C-r>0<CR>
" f: Find this file
" nnoremap  <leader>ff yiw:call cscope#find('f', expand('<cword>'))<CR>/\<\><Left><Left><C-r>0<CR>
" i: Find files #including this file
" nnoremap  <leader>fi yiw:call cscope#find('i', expand('<cword>'))<CR>/\<\><Left><Left><C-r>0<CR>
" æ›´æ–°æ•°æ®åº“
" nmap <F12> :cs kill -1<CR>:silent !myfind *.h*.hpp*.c*.cc*.cpp > cscope.files<CR>:silent !cscope -bkq -i cscope.files<CR>:cs add cscope.out<CR>:silent !cat cscope.files \| xargs ctags --c++-kinds=+p+l+x+c+d+e+f+g+m+n+s+t+u+v --fields=+liaS --extra=+q<CR>:NeoCompleteTagMakeCache<CR><CR>
" nmap <F12> :cs kill -1<CR>:silent !myfind *.h*.hpp*.c*.cc*.cpp > cscope.files<CR>:silent !cscope -bkq -i cscope.files<CR>:cs add cscope.out<CR>:silent !cat cscope.files \| xargs ctags --c++-kinds=+p+l+x+c+d+e+f+g+m+n+s+t+u+v --fields=+liaS --extra=+q<CR>:NeoCompleteTagMakeCache<CR>
" nmap <F12> :cs kill -1<CR>:!myfind *.h*.hpp*.c*.cc*.cpp > cscope.files<CR>:!cscope -bkq -i cscope.files<CR>:cs add cscope.out<CR><CR>
" nnoremap <F12> :silent !ctags -R --c++-kinds=+p+l+x+c+d+e+f+g+m+n+s+t+u+v --fields=+liaS --extra=+q .<CR>
nnoremap <C-F12> :silent !ctags -R --c++-kinds=+p+l+x+c+d+e+f+g+m+n+s+t+u+v --fields=+liaS --extra=+q . && cscope -bkq -i cscope.files<CR>:cs kill -1<CR>:cs add .<CR>


""" ä»£ç æ”¶è— vim-signature
"" è‡ªå®šä¹‰ vim-signature å¿«æ·é”®
"let g:SignatureMap = {
        "\ 'Leader'             :  "m",
        "\ 'PlaceNextMark'      :  "m,",
        "\ 'ToggleMarkAtLine'   :  "m.",
        "\ 'PurgeMarksAtLine'   :  "m-",
        "\ 'DeleteMark'         :  "dm",
        "\ 'PurgeMarks'         :  "mda",
        "\ 'PurgeMarkers'       :  "m<BS>",
        "\ 'GotoNextLineAlpha'  :  "']",
        "\ 'GotoPrevLineAlpha'  :  "'[",
        "\ 'GotoNextSpotAlpha'  :  "`]",
        "\ 'GotoPrevSpotAlpha'  :  "`[",
        "\ 'GotoNextLineByPos'  :  "]'",
        "\ 'GotoPrevLineByPos'  :  "['",
        "\ 'GotoNextSpotByPos'  :  "mn",
        "\ 'GotoPrevSpotByPos'  :  "mp",
        "\ 'GotoNextMarker'     :  "[+",
        "\ 'GotoPrevMarker'     :  "[-",
        "\ 'GotoNextMarkerAny'  :  "]=",
        "\ 'GotoPrevMarkerAny'  :  "[=",
        "\ 'ListLocalMarks'     :  "ms",
        "\ 'ListLocalMarkers'   :  "m?"
        "\ }

""" code folding
set fdm=syntax

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""



""""""""""""""""""""""""""" Section ä»£ç è‡ªåŠ¨å®Œæˆ Auto Complete"""""""""""""""""""""""""""

""" UltiSnips çš„ tab é”®ä¸ YCM å†²çªï¼Œé‡æ–°è®¾å®š
let g:UltiSnipsSnippetDirectories="vim-snippets/UltiSnips/"
let g:UltiSnipsExpandTrigger="<leader><tab>"
let g:UltiSnipsJumpForwardTrigger="<leader><tab>"
let g:UltiSnipsJumpBackwardTrigger="<leader><s-tab>"

""" YouCompleteMe
"" YCM è¡¥å…¨èœå•é…è‰²
" èœå•
highlight Pmenu ctermfg=2 ctermbg=3 guifg=#005f87 guibg=#EEE8D5
" é€‰ä¸­é¡¹
highlight PmenuSel ctermfg=2 ctermbg=3 guifg=#AFD700 guibg=#106900

" è¡¥å…¨åŠŸèƒ½åœ¨æ³¨é‡Šä¸­åŒæ ·æœ‰æ•ˆ
let g:ycm_complete_in_comments=1
" å…è®¸ vim åŠ è½½ .ycm_extra_conf.py æ–‡ä»¶ï¼Œä¸å†æç¤º
let g:ycm_confirm_extra_conf=0
" å¼€å¯ YCM æ ‡ç­¾è¡¥å…¨å¼•æ“
let g:ycm_collect_identifiers_from_tags_files=1
" å›è½¦å³é€‰ä¸­å½“å‰é¡¹ ycm
inoremap <expr><CR> pumvisible() ? "\<C-y>" : "\<CR>"
" set tags+=/usr/include/c++/4.8/stdcpp.tags 		 			" å¼•å…¥ C++ æ ‡å‡†åº“ tags
" YCM é›†æˆ OmniCppComplete è¡¥å…¨å¼•æ“ï¼Œè®¾ç½®å…¶å¿«æ·é”®
inoremap <leader>; <C-x><C-o>
" è¡¥å…¨å†…å®¹ä¸ä»¥åˆ†å‰²å­çª—å£å½¢å¼å‡ºç°ï¼Œåªæ˜¾ç¤ºè¡¥å…¨åˆ—è¡¨
set completeopt-=preview
" ä»ç¬¬ä¸€ä¸ªé”®å…¥å­—ç¬¦å°±å¼€å§‹ç½—åˆ—åŒ¹é…é¡¹
let g:ycm_min_num_of_chars_for_completion=1
" ç¦æ­¢ç¼“å­˜åŒ¹é…é¡¹ï¼Œæ¯æ¬¡éƒ½é‡æ–°ç”ŸæˆåŒ¹é…é¡¹
let g:ycm_cache_omnifunc=0
" è¯­æ³•å…³é”®å­—è¡¥å…¨
let g:ycm_seed_identifiers_with_syntax=1
" å…¨å±€é…ç½®æ–‡ä»¶
let ycm_global_ycm_extra_conf="~/.vim/bundle/YouCompleteMe/third_party/ycmd/examples/.ycm_extra_conf.py"

""" æ³¨é‡Š NERDCommenter
" æ³¨é‡Šç¬¦åè·Ÿä¸€ä¸ªç©ºæ ¼
let NERDSpaceDelims = 1
nmap <F7> <leader>ci
vmap <F7> <leader>ci
nmap <S-F7> <leader>cs
vmap <S-F7> <leader>cs

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""


"""""""""""Section ä»£ç æ’ç‰ˆ""""""""""""""""""""""

"""""""Easy Align
" Start interactive EasyAlign in visual mode (e.g. vip<Enter>)
vmap <Enter> <Plug>(EasyAlign)
" Start interactive EasyAlign for a motion/text object (e.g. gaip)
nmap ga <Plug>(EasyAlign)

"""""""""""""""""""""""""""""""""""""""""""""""""


""""""""""" Section vim-bookmarks""""""""""""""""""

nmap <Leader>mm :BookmarkToggle<CR>
nmap <Leader>mi :BookmarkAnnotate<CR>
nmap <Leader>m/ :BookmarkShowAll<CR>
nmap <Leader>mn :BookmarkNext<CR>
nmap <Leader>mp :BookmarkPrev<CR>
" nmap <Leader>mc :BookmarkClear<CR>
" nmap <Leader>mx :BookmarkClearAll<CR>
nmap <Leader>mkk :BookmarkMoveUp<CR>
nmap <Leader>mjj :BookmarkMoveDown<CR>

let g:bookmark_no_default_key_mappings = 1
let g:bookmark_auto_save = 1
let g:bookmark_save_per_working_dir = 1
let g:bookmark_highlight_lines = 1
" Turn off the warning when clearing all bookmarks
let g:bookmark_show_warning = 0
" Turn off the warning when toggling to clear a bookmark with annotation
let g:bookmark_show_toggle_warning = 0
" Turn on vertical line centering when jumping to bookmark
let g:bookmark_center = 1
" use location list
" let g:bookmark_location_list = 1
" highlight BookmarkSign ctermbg=NONE ctermfg=160
" highlight BookmarkLine ctermbg=194 ctermfg=NONE
let g:bookmark_sign = 'ğŸ'
let g:bookmark_annotation_sign = 'ğŸ'
let g:bookmark_highlight_lines = 1

call unite#custom#profile('source/vim_bookmarks', 'context', {
    \   'winheight': 50,
    \   'direction': 'belowright',
    \   'start_insert': 0,
    \   'keep_focus': 1,
    \   'no_quit': 1,
    \ })

command Sm :BookmarkSave bookmark.vim
command Lm :BookmarkLoad bookmark.vim
command Bmc :BookmarkClear
command Bmca :BookmarkClearAll

function! AutoSaveBookmark()
   if filereadable("bookmark.vim")
       execute 'Sm'
   endif
endfunction
autocmd VimLeave * :call AutoSaveBookmark()

"""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""""""""" Unite""""""""""""""""""""""""""""
nnoremap <Leader>ub :Unite buffer -direction=belowright<CR>
nnoremap <silent> <F9> ::UniteResume<CR>
nnoremap <silent><C-b> :Unite buffer -direction=belowright<CR>
nnoremap <Leader>uf :Unite file -direction=belowright<CR>
nnoremap <Leader>ur :Unite file_rec -direction=belowright<CR>
nnoremap <S-F10> :Unite file_rec -direction=belowright<CR>
nnoremap <Leader>us :UniteResume<CR>
nnoremap <Leader>un :UniteNext<CR>
nnoremap <Leader>up :UnitePrevious<CR>
" In unite window, press Esc to quit
autocmd FileType unite nmap <silent><buffer> <Esc> :UniteClose<CR>:call AdjustCursor()<CR>
autocmd FileType unite nmap <silent><buffer> <F9> :UniteClose<CR>:call AdjustCursor()<CR>

"""""""""""""""""""""""""""""""""""""""""""""""""""


""""""""""""""""""""""CtrlP""""""""""""""""""""""""
let g:ctrlp_cmd = 'CtrlP .'
let g:ctrlp_open_multiple_files = 'i'
""" ctrlp-bdelete
call ctrlp_bdelete#init()
nnoremap <C-F9> :CtrlP %:p:h<CR>

"""""""""""""""""""""""""""""""""""""""""""""""""""


"""""""""""""""""""""Others""""""""""""""""""""""""
" åˆ‡æ¢è·¯å¾„åˆ°å½“å‰æ‰€ç¼–è¾‘æ–‡ä»¶æ‰€åœ¨ç›®å½•
nnoremap <Leader>cwd :cd %:p:h<CR>:pwd<CR>
""" airline
" tagbar
let g:airline#extensions#tagbar#enabled = 1
" tab
" let g:airline#extensions#tabline#enabled = 1

"""""""""""""""""""""""""""""""""""""""""""""""""""


" æ›¿æ¢

" æ›¿æ¢å‡½æ•°ã€‚å‚æ•°è¯´æ˜ï¼š
" confirmï¼šæ˜¯å¦æ›¿æ¢å‰é€ä¸€ç¡®è®¤
" wholewordï¼šæ˜¯å¦æ•´è¯åŒ¹é…
" replaceï¼šè¢«æ›¿æ¢å­—ç¬¦ä¸²
function! Replace(confirm, wholeword, replace)
    wa
    let flag = ''
    if a:confirm
        let flag .= 'gec'
    else
        let flag .= 'ge'
    endif
    let search = ''
    if a:wholeword
        let search .= '\<' . escape(expand('<cword>'), '/\.*$^~[') . '\>'
    else
        let search .= expand('<cword>')
    endif
    let replace = escape(a:replace, '/\&~')
    execute 'argdo %s/' . search . '/' . replace . '/' . flag . '| update'
endfunction
" ä¸ç¡®è®¤ã€éæ•´è¯
nnoremap <Leader>R :call Replace(0, 0, input('Replace '.expand('<cword>').' with: '))<CR>
" ä¸ç¡®è®¤ã€æ•´è¯
nnoremap <Leader>rw :call Replace(0, 1, input('Replace '.expand('<cword>').' with: '))<CR>
" ç¡®è®¤ã€éæ•´è¯
nnoremap <Leader>rc :call Replace(1, 0, input('Replace '.expand('<cword>').' with: '))<CR>
" ç¡®è®¤ã€æ•´è¯
nnoremap <Leader>rcw :call Replace(1, 1, input('Replace '.expand('<cword>').' with: '))<CR>
nnoremap <Leader>rwc :call Replace(1, 1, input('Replace '.expand('<cword>').' with: '))<CR>



" <<

" é™æ€åˆ†æå™¨ syntastic é”™è¯¯æ ‡è¯†
let g:syntastic_error_symbol = 'âœ—'
let g:syntastic_warning_symbol = 'âš '

" >>
" ç”±æ¥å£å¿«é€Ÿç”Ÿæˆå®ç°æ¡†æ¶

" è®¾ç½® pullproto.pl è„šæœ¬è·¯å¾„
let g:protodefprotogetter='~/.vim/bundle/vim-protodef/pullproto.pl'

" æˆå‘˜å‡½æ•°çš„å®ç°é¡ºåºä¸å£°æ˜é¡ºåºä¸€è‡´
let g:disable_protodef_sorting=1


" ç¯å¢ƒæ¢å¤

" è®¾ç½®ç¯å¢ƒä¿å­˜é¡¹
set sessionoptions="blank,globals,localoptions,tabpages,sesdir,folds,help,options,resize,winpos,winsize"

" ä¿å­˜ undo å†å²
set undodir=~/.undo_history/
set undofile

" ä¿å­˜å¿«æ·é”®
"nnoremap <leader>ss :mksession! my.vim<cr> :wviminfo! my.viminfo<cr>
nnoremap <leader>ss :mksession! my.vim<cr>

" æ¢å¤å¿«æ·é”®
"nnoremap <leader>rs :source my.vim<cr> :rviminfo my.viminfo<cr>
nnoremap <leader>rs :source my.vim<cr>


" è°ƒç”¨ gundo æ ‘
nnoremap <Leader>ud :GundoToggle<CR>

" >>
" web å‰ç«¯

" surrond æ·»åŠ  <p> å…ƒç´ çš„å¿«æ·é”®
" nmap <Leader>ap yss<p><CR>

" å¯¹ HTML å…ƒç´ è¿›è¡Œè½¬ä¹‰ï¼š< -> &lt;ã€> -> &gt;ã€& -> &amp;ã€ç©ºæ ¼ -> &nbsp;ã€è¡Œå°¾æ·»åŠ  <br />
" å…ˆåé¡ºåºæ•æ„Ÿ
" function HtmlEscape()
    " retab<CR>
    " silent s/&/\&amp;/eg
    " silent s/</\&lt;/eg
    " silent s/>/\&gt;/eg
    " silent s/ /\&nbsp;/eg
    " silent s/$/<br \/>/eg
" endfunction
" vnoremap <Leader>he :call HtmlEscape()<CR>

" <<

" let OmniCpp_DefaultNamespaces = ["_GLIBCXX_STD"]



